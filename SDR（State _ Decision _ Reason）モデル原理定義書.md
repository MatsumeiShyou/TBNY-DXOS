# **SDR（State / Decision / Reason）モデル原理定義書**

## **序文：SDRモデルとは何か（Why）**

業務システム設計の核心には、常に一つの問いが存在します。それは「どのようにして“判断”を記録するか」という問いです。我々が構築するシステムは、単に現在の状態を表示するだけでなく、その状態に至るまでの無数の意思決定の歴史を、未来の資産として保存する責務を負っています。SDR（State / Decision / Reason）モデルは、この核心的課題に対する我々の答えであり、単なる技術選択ではなく、業務の健全性を永続的に維持するための必然的な設計思想です。

### **なぜ従来のモデルでは不十分なのか**

従来のデータモデル、特にCRUD（Create, Read, Update, Delete）を基本とする設計は、今日の複雑な業務要件に対して致命的な欠陥を抱えています。`UPDATE`文はレコードの値を無慈悲に上書きし、「当初の計画はどうだったのか」という貴重な事実を破壊します。同様に、`DELETE`文は「その計画が存在した」という事実そのものを抹消します。例えば、回収予定を単純に削除すると、我々は「当初は回収に行く計画だったが、何らかの理由でスキップした」という重要な業務事実を失い、計画と実績の乖離を分析する機会を永久に失います。正しくは、`is_skipped=true`のようなフラグで「実行されなかった」という事実を記録することです。

また、ステートマシンや固定的なワークフローモデルは、理想的な業務フローを定義するには有効ですが、現実の業務で頻発する「現場例外」に対して極めて脆弱です。「DX設計憲法」が掲げる\*\*「現場例外を否定しない」\*\*という最上位原則は、このような硬直的なモデルが、現場の柔軟性を奪い、最終的に使われないシステムを生み出す危険性を警告しています。SDRモデルは、この硬直性を打破し、例外すらも正規のデータとして取り扱うために生まれました。

### **なぜ「判断」がデータ構造から抜け落ちると事故が起きるのか**

「誰が、いつ、なぜ」その状態変更を決めたのかという情報が失われることは、単なる情報欠損ではありません。それは、システムの論理的破綻であり、取り返しのつかない業務事故の温床となります。

* **監査対応の崩壊**: 監査官からの「この数値変更の根拠は？」という問いに、システムは沈黙するしかありません。  
* **トラブル原因の究明不能**: 問題が発生した際、それが意図された変更なのか、システムのバグなのか、あるいは不正操作なのかを切り分ける術が失われます。  
* **将来の業務改善の放棄**: 過去の判断とその結果を分析できなければ、AIによる学習や業務プロセスの改善は永遠に不可能です。

「DX設計憲法」が定める\*\*「状態と履歴は不可逆」\*\*の原則は、過去の事実を改ざんせず、すべての変更を新たな「イベント」として追跡可能にすることを要求します。「判断」の記録を欠いたシステムは、この原則に反し、組織の知的財産を日々破壊し続ける負債となります。

### **SDRは何を守るためのモデルなのか**

SDRモデルが守る対象は、短期的な開発効率や単純な機能実装ではありません。我々が守るべきものは、より長期的で本質的な4つの事業価値です。

* **業務の一貫性（Consistency）**: 計画と実績、理想と現実がデータ上で混濁することなく、常に対比可能な状態を守ります。  
* **判断の責任（Accountability）**: すべての意思決定が、その責任者と文脈と共に記録され、説明責任を果たせる状態を守ります。  
* **組織の記憶（Organizational Memory）**: 過去の無数の判断の歴史を、分析可能な資産として蓄積し、組織が未来へ向けて学習し続けるための土台を守ります。  
* **将来の改善可能性（Improvability）**: 過去の判断とその結果を分析することで、未来の業務プロセスやシステムの判断精度を向上させるための基盤を守ります。

本定義書は、このSDRモデルの基本定義、守るべき不変条件、そして実践における指針を明文化するものです。次章では、SDRを構成する3つの基本要素を厳密に定義します。

## **1\. 基本定義（What）**

SDRモデルは、「State（状態）」「Decision（判断）」「Reason（理由）」という、論理的に不可分な3つの要素で構成されます。これらは単なるデータベースのカラム名ではなく、業務における「事実」「意思」「正当性」をそれぞれ記録するための設計上の役割分担です。この3要素が三位一体で機能することで初めて、業務の健全性と追跡可能性が担保されます。

### **1.1. State（状態）**

`State`は、特定の時点における観測可能な**事実のスナップショット**である。

* **`State`は「事実のスナップショット」である** `State`は、ある一時点における業務オブジェクトの観測可能な事実の記録です。それ自体に意思や未来の予定、変更の意図を含みません。例えば、「二段階確定モデル」における`confirmed`状態の配車計画は、未来の意図を示すものではなく、「その確定タイムスタンプの時点で、これが公式な計画であった」という変更不可能な過去の事実です。  
* **`State`は結果であり、意思ではない** `State`は、常に過去の`Decision`の結果としてのみ存在します。`State`が自律的に変化することはあり得ず、その遷移には必ず起因となる`Decision`が存在します。  
* **`State`を直接変更すると何が壊れるか** データベースの`UPDATE`文などで`State`を直接上書きする行為は、システムの論理的整合性を根本から破壊します。なぜなら、それは「当初の計画はどうだったのか」という極めて重要な事実を消去する行為だからです。計画と実績の対比分析が不可能になり、過去の判断から学ぶ機会が永久に失われます。これは、システムの存在意義の一部である\*\*「組織の記憶」を破壊する行為\*\*に他なりません。

### **1.2. Decision（判断）**

`Decision`は、ある`State`を別の`State`へ遷移させることを意図した、**責任者を伴う意思表明**の記録である。

* **`Decision`は「状態を変える意思表明」である** `Decision`は、システムの状態に変化をもたらすための、人間または人間が定めたルールによる能動的な操作の記録です。「管理者による強制スワップ」や「実績値の修正承認」といった操作は、すべて`event_logs`テーブルに`Decision`として記録されなければなりません。  
* **UI操作 ≠ `State`変更** ユーザーによる画面上のボタンクリックやドラッグ＆ドロップといったUI操作は、`Decision`を生成するためのトリガーではありますが、`State`を直接変更する行為ではありません。システムはUIイベントを受け取り、それを解釈して構造化された`Decision`レコードを生成し、その`Decision`に基づいて初めて`State`が変化するという原則を厳守します。  
* **`Decision`が存在しない変更は「事故」である理由** `Decision`を介さずに`State`が変更される事象は、その意思決定の主体と背景が記録されないため、システム上では追跡不可能な「データ破壊」または「事故」として扱われます。「DX設計憲法」が掲げる\*\*「人間の最終判断権」\*\*の原則に基づき、全ての状態変更は必ず責任ある主体による`Decision`に起因しなければなりません。例えば、管理者による例外的な強制操作は`event_logs`内の`is_admin_forced`フラグを`true`に設定した`Decision`として正式に記録され、「現場例外を否定しない」原則をデータ事故を起こすことなく満たします。

### **1.3. Reason（理由）**

`Reason`は、特定の`Decision`がなぜ行われたのか、その**判断の正当性の根拠**を記録する不可欠な要素である。

* **`Reason`は「判断の正当性の根拠」である** `Reason`は、「なぜ」その`Decision`が下されたのかを記録し、判断の正当性と背景情報を後世に伝えるためのものです。例えば、`event_logs`テーブルにおける`correction_reason`フィールドは、実績値修正という`Decision`の妥当性を担保するために不可欠です。  
* **自由記述（free text）の危険性** 理由の記録を単なる自由記述のテキスト欄に委ねることは、安易な設計上の逃避です。自由記述に頼りすぎると、データとしての構造性が失われ、後続のデータ分析、監査の自動化、システムによる警告の精度向上などを著しく妨げます。  
* **分類＋補足の意味** 効果的な`Reason`の実装は、常に\*\*「理由コードによる分類」**と**「補足的なテキスト情報」\*\*の組み合わせで構成されるべきです。理由コード（`enum`や`type`）はシステムによる自動処理と分析可能性を担保し、補足テキストは人間が文脈を理解するための補助情報として機能します。

これら`State`、`Decision`、`Reason`の3要素は、それぞれが独立しつつも密接に連携し、業務の完全な記録を形成します。この三位一体の原則を破ることは、システムの信頼性を根底から揺るがす行為です。次章では、このモデルの健全性を保証するための不変条件を定義します。

## **2\. SDRが満たすべき不変条件（Invariants）**

SDRモデルの健全性を保証するためには、いかなる技術実装やアーキテクチャを採用するかにかかわらず、絶対に破られてはならない4つの公理（Axioms）が存在します。これらの不変条件は、システムの論理的整合性と監査耐性を担保するための設計上の契約であり、すべての設計、実装、レビューの基礎となります。

1. **`State`は`Decision`の結果としてのみ変化する。**  
   * 解説：これにより、意図や責任者の不明な状態変化がシステム内に存在しなくなり、全ての変更が説明可能になります。  
2. **`Decision`は必ず`Reason`を伴う。**  
   * 解説：これにより、全ての意思決定がなぜ行われたのかという文脈を保持し、将来の監査や分析に耐えうるものとなります。  
3. **`Decision`は履歴として不可逆に残る。**  
   * 解説：これにより、「DX設計憲法」の\*\*「状態と履歴は不可逆」\*\*の原則が保証され、完全な監査証跡が維持されます。`Decision`は削除や上書きが許されない、追記専用（append-only）の記録です。  
4. **`State` / `Decision` / `Reason`はデータ構造上で混合してはならない。**  
   * 解説：これにより、各要素の責務が明確に分離され、システムの可読性、保守性、そして将来の拡張性が担保されます。例えば、`State`を記録する`daily_jobs`テーブルに`cancellation_reason`のような`Reason`情報を示すカラムを含める行為は、`State`エンティティを汚染する重大な設計違反です。理由はキャンセルという`Decision`と共に`event_logs`テーブルに記録されなければなりません。

これらの不変条件は、SDRモデルの根幹をなすものです。これらの条件を一つでも破ることは、単なる実装上の誤りではなく、システムの信頼性を根本から破壊する行為と見なされます。次章では、この原則を誤解した際に陥りやすいアンチパターンを解説します。

## **3\. よくある誤解とアンチパターン**

SDRモデルの思想を正しく理解せず、短期的な開発効率を優先したがゆえに行われる安易な設計は、システムの長期的価値を著しく破壊します。良かれと思って導入されたそれらの設計は、将来的に必ず技術的負債となり、業務の健全性を蝕みます。ここでは、SDRモデルの根幹を破壊する典型的な設計上の誤りを「アンチパターン」として提示し、警鐘を鳴らします。

### **3.1. 「状態を`enum`で管理すれば十分」という誤解**

最も頻繁に見られる誤解の一つが、`status`カラムに状態（例：`'PLANNED'`, `'CONFIRMED'`, `'CANCELLED'`）を`enum`として保存すれば十分だという考え方です。

この設計では、`'CANCELLED'`という`State`（事実）は記録できますが、「いつ、誰が、なぜ」そのキャンセルを決定したのかという、最も重要な`Decision`と`Reason`が完全に欠落します。これは、監査証跡を放棄し、トラブル発生時の原因究明を不可能にする行為です。このアンチパターンは、SDRモデルが守るべき\*\*「組織の記憶」を自ら放棄する\*\*ことに等しい設計です。

### **3.2. 「ログを取っているから大丈夫」という誤解**

「アプリケーションログに操作履歴を出力しているから問題ない」という主張もまた、SDRの本質を理解していない証左です。

デバッグや障害調査を目的とした揮発的なアプリケーションログと、業務データモデルの一部として永続的に保存される構造化された`Decision`レコード（`event_logs`テーブル）は、その目的、永続性、信頼性のいずれにおいても全く異なります。SDRにおける`Decision`は、一時的な記録ではなく、業務の歴史を公式に記録する\*\*監査可能な「正史」\*\*です。アプリケーションログを`Decision`の代替とすることはできません。

### **3.3. 「例外処理だから例外的に更新する」という破壊行為**

「これは緊急の例外対応だから、ルールを無視して直接データベースを更新する」という行為は、システムの論理整合性を破壊する最も悪質なアンチパターンです。

「DX設計憲法」が掲げる\*\*「現場例外を否定しない」\*\*という原則は、例外的な事態をバックドア的な直接更新で処理することを正当化するものでは断じてありません。むしろ、その逆です。この原則は、例外的な状況こそ、正規の`Decision`として正式に記録し、その`Reason`を明確にすることを要求します。**例外こそ、最も厳密な`Decision`と`Reason`が求められる事象**であり、それを記録するプロセスを省略することは、システムの信頼性に対する重大な裏切り行為です。

### **3.4. 「AIが最適化すれば良い」という設計破綻**

AIによる業務最適化は強力な武器ですが、その役割を誤解すると設計を破綻させます。「AIが最適なルートを提案したから、それがそのまま計画になる」という考え方は、責任の所在を放棄する設計上の怠慢です。

「DX設計憲法」の\*\*「人間の最終判断権」\*\*の原則に基づき、AIによる提案は`Decision`そのものではありません。それはあくまで質の高い「提案（Proposal）」です。AIの提案を人間（または人間が事前に定義したルール）がレビューし、「承認」する行為こそが`Decision`であり、このプロセスを省略するシステムは、責任の所在を曖昧なブラックボックスに転嫁する、許されざる設計です。

これらのアンチパターンを避けることが、SDRモデルの価値を最大限に引き出し、持続可能で信頼性の高いシステムを構築するための鍵となります。

## **4\. Soft Change / Hard Change の原理的位置づけ**

業務の現場では、すべての変更が同じ重みを持つわけではありません。日々の微調整のように迅速さが求められる変更（Soft Change）と、厳格な統制と明確な承認が必要な強制変更（Hard Change）が存在します。一見すると、「速度」と「統制」はトレードオフの関係にあるように思えますが、SDRモデルはこの二つを矛盾なく両立させるための原理を提供します。

### **なぜ「承認不要変更」が存在してもよいのか**

SDRモデルは、すべての変更に多段階の承認プロセスを強制するものではありません。業務の重要度や影響範囲に応じて、承認プロセスは柔軟に変化すべきです。例えば、担当者レベルで完結する軽微な時間調整は、承認プロセスを省略することで業務速度を向上させることができます。

しかし、重要なのは、**承認プロセスの有無と、「変更の意思決定があった」という事実を記録することの必要性は全く別の問題である**という点です。承認が不要な変更であっても、それは紛れもなく`Decision`の一つです。

### **なぜそれでも`Decision`は必要なのか**

Soft Changeであっても、`Decision`として記録されることには極めて重要な意味があります。なぜなら、それによって「誰が、いつ、その判断をしたか」という**責任の所在は明確に保持される**からです。

承認プロセスを省略することは、責任の所在を曖昧にすることと同義ではありません。SDRモデルは、Soft Changeを`Decision`として記録することで、業務の機動性を確保しつつも、説明責任を放棄しないという絶妙なバランスを実現します。

### **業務速度と統制が両立できる理由**

SDRモデルが業務速度と厳格な統制を両立できる理由は、その核心にあります。SDRは、承認プロセスの有無や変更の種別（通常操作か管理者強制か）を問わず、**全ての状態変更を「`Decision`」という統一された概念で一元的に記録するモデル**だからです。

* **Soft Change**: 承認プロセスを省略した`Decision`として記録される。  
* **Hard Change**: 承認プロセスと、より詳細な`Reason`を伴う`Decision`として記録される。

この統一されたアプローチにより、システムは現場の柔軟性を最大限に許容しながら、いかなる変更も見逃すことなく、完全な監査証跡を維持することができます。速度と統制はトレードオフではなく、SDRという設計思想の下で両立可能なのです。

この原理は、人間とAIが協調して業務を進める未来のシステムにおいても、その役割分担を明確にするための基盤となります。

## **5\. 人間・AI・システムの責務分離**

「DX設計憲法」の最上位原則である\*\*「人間の最終判断権は常に最優先」\*\*は、我々の設計における絶対的な北極星です。SDRモデルは、この思想をシステム設計のレベルに具体的に落とし込み、人間、AI、そしてシステムの役割を明確に分離するためのフレームワークとして機能します。特に、進化し続けるAI技術を業務に正しく位置づけることは、システムの健全性を保つ上で極めて重要です。

### **SDRモデルにおけるAIの正しい居場所**

AIの役割は、決して「判断」そのものではありません。SDRモデルにおいて、AIの正しい居場所は、システムに蓄積された膨大な`State`（事実の履歴）と`Decision`（過去の判断の歴史）を分析し、人間に対してより質の高い\*\*「提案（Proposal）」\*\*を行うことに限定されます。

AIは、遅延リスクを予測し、最適なスワップ候補を提示し、効率的なルートを計算することはできますが、それらはすべて、人間の最終判断を補助するためのインプットに過ぎません。

### **`AI Proposal`と`Decision`の決定的違い**

システム設計において、AIによる「提案（Proposal）」と、人間による「判断（Decision）」は、データ構造上もプロセスのフロー上も、明確に区別されなければなりません。この両者には、責任の所在という点で非対称な関係が存在します。

* **`Proposal`（提案）**: 責任を伴わない、判断のための材料。システムはこれを複数提示することも、その確度を示すこともできます。  
* **`Decision`（判断）**: 最終的な責任を伴う、人間の意思決定。システムは、どの`Proposal`が採用されたのか、あるいは全く新しい`Decision`が下されたのかを、その実行者と共に記録します。

### **「AIが判断した」ように見せてはいけない理由**

AIの提案を、人間の介在なしに自動的に`Decision`としてシステムに記録する、あるいはUI/UX上そのようにユーザーに誤認させるような設計は、**「DX設計憲法」に違反する行為**です。

このような設計は、判断の責任の所在を曖昧にし、システムというブラックボックスに転嫁します。万が一、AIの提案に基づいた自動処理が重大な業務トラブルを引き起こした場合、その責任は誰が負うのでしょうか。システムは責任を負えません。この曖昧さは、**人間の判断権を侵害し、組織のガバナンスを根本から破壊する**ため、断じて許容されません。

人間、AI、システムの責務分離を徹底することこそが、技術の進化に対して業務の健全性を保つための防波堤であり、SDRモデルがその実装を強力に支援します。

## **6\. なぜSDRは“設計思想”であり“実装パターンではない”のか**

SDRモデルの本質を理解する上で最も重要なことは、それが特定の技術スタックや実装手法に依存する「実装パターン」ではなく、より上位の普遍的な「設計思想」であるという点です。SDRの本質は、どのデータベースを選ぶか、どのフレームワークを使うかという問いではなく、ビジネスにおける「判断」という人間的な行為を、いかにして追跡可能で分析可能なデータとして捉えるか、という根本的な問いに対する我々の答えです。

### **特定技術に依存しない理由**

SDRの原理は、特定の技術に縛られません。Supabase/PostgreSQLであろうと、他のいかなるデータベースやアーキテクチャであろうと実現可能です。重要なのは、技術選択そのものではなく、以下の論理的な関係性をシステム上で実装することです。

* `State`の不変性（上書きではなく、新しいスナップショットとして追加する）  
* `Decision`の追記性（削除・更新を許さず、常に追記する）  
* `Reason`の必須性（`Decision`には必ず理由が紐づく）

この論理的構造さえ守られていれば、その実装方法はプロジェクトの技術的要件に応じて自由に選択できます。SDRはコードではなく、思想なのです。

### **将来技術が変わっても壊れない理由**

テクノロジーの世界は常に変化します。しかし、AIやブロックチェーンといった新しい技術が登場したとしても、「人間が状況を認識し、判断を下し、その結果に責任を負う」という業務の本質は決して変わりません。

SDRモデルは、この不変の業務本質をデータモデルとして抽象化したものです。そのため、それを支える基盤技術がどのように進化しようとも、SDRの思想そのものが陳腐化することはありません。むしろ、新しい技術が登場するたびに、SDRによって蓄積された高品質な「判断のデータ」は、その価値を増していくでしょう。

### **業務が変わっても再利用できる理由**

現在、我々は配車管理業務にSDRモデルを適用していますが、この思想の適用範囲はそれに留まりません。在庫管理、顧客対応、人事評価など、あらゆる業務は本質的に「状態」と「それを変化させる判断」の連続で構成されています。

したがって、配車管理システムで確立されたSDRの設計思想は、将来的に他の業務領域へシステムを展開する際にも、そのまま再利用可能な強力なフレームワークとなります。個別の業務ロジックは変わっても、その根底にある「判断を記録する」という思想は、組織全体のDXを支える共通言語となり得るのです。

SDRを単なる実装パターンとしてではなく、普遍的な設計思想として理解すること。それこそが、目先の課題解決に留まらず、変化に強く、持続可能なシステムを構築する上で不可欠な視点です。

## **7\. 結論：SDRモデルが守っているもの**

SDRは単なるデータモデリングの手法ではありません。それは、事業の継続性と健全性を守るために、設計者が自らに課す厳格な**設計上の契約**です。この契約を遵守することで、我々はシステムを通じて4つの核心的な事業価値を永続的に保護します。

* **業務の一貫性（Consistency）** 計画と実績、理想と現実がデータ上で混濁することなく、常に区別して扱える状態を保護します。「当初の計画はどうだったか」という事実を、その後の変更の歴史から守り抜きます。  
* **判断の責任（Accountability）** 「誰が、いつ、なぜ」その決定を下したのかという情報を、決して失われることのない監査証跡として永久に記録し、組織が常に説明責任を果たせる状態を保護します。  
* **組織の記憶（Organizational Memory）** 過去の成功も失敗も含め、無数の判断の歴史を、分析可能で再利用可能な知的資産として蓄積します。これにより、組織が過去から学び、未来へ向けて進化し続ける状態を保護します。  
* **将来の改善可能性（Improvability）** 蓄積された過去の判断とその結果（Stateの変化）を分析することで、未来の業務プロセスやAIによる提案の精度を継続的に向上させるための、信頼できるデータ基盤を保護します。

SDR原則への違反は、単なる技術的負債の発生を意味しません。それは、我々が守るべきこれら4つの価値すべてを一度に破壊し、システムの存在意義そのものを失わせる行為です。設計者は、この一点を生命線として理解しなければなりません。

**これを破った時、我々のシステムは信頼できる記録装置であることをやめ、単なる混沌の写し鏡に成り下がります。その瞬間、プロジェクトは終わるのです。**

補足注記（Interpretation Notes）

A. 本文中に登場する技術名・テーブル名・実装例について    
本定義書において言及される特定の技術名（例：PostgreSQL、Supabase）や  
データ構造名（例：event\_logs テーブル）は、  
SDRモデルの思想を具体的に理解するための例示であり、  
特定技術・構成・実装手法への拘束を意図するものではない。

本質的な拘束力は、State / Decision / Reason の三位一体原則と、  
それらが満たすべき不変条件（Invariants）にのみ存在する。  
実装は、各プロジェクトの技術的・組織的制約に応じて  
自由に最適化されるべきである。

B. SDRモデルの“絶対視”に対する注意    
SDRモデルは、設計上の思考停止を防ぐための「判断の補助線」であり、  
現実の業務や組織判断を縛るための教義ではない。

本モデルにおけるすべての原則は、  
「判断を記録し、説明可能性を保つ」という目的に奉仕する限りにおいて有効である。  
仮に現実の制約や緊急性によって一部の原則が一時的に満たせない場合でも、  
それ自体が思想違反や失敗を意味するものではない。

重要なのは、  
“原則を破った事実”ではなく、  
“なぜその判断が必要だったのかを記録し、後から検証可能にしているか”である。

