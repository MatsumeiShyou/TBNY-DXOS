以下は現在開発中のプロジェクトです。管理側アプリとセット二つで一つのアプリですが管理側は坪野谷厚木事業所社員の管理権限肘者のみの機能です。完成次第、このBusiness OS上の1つのモジュールとして統合されます。

\*\*セルフ計量記録アプリDriver\*\*  
は社外協力会社用のアプリです。  
以下に二つのアプリ  
\# １\*\*セルフ計量記録アプリDriver\*\*  
\#  2\*\*セルフ計量記録アプリ 管理画面\*\*  
の説明とします

\# １\*\*セルフ計量記録アプリDriver\*\*

\#\# \*\*概要\*\*

本プロジェクトは、荷受け業務における計量プロセスをデジタル化するためのプログレッシブウェブアプリケーション（PWA）です。ドライバーが自身のスマートフォンを使用して、簡単かつ正確に計量記録を入力できるセルフサービスな仕組みを提供します。

\#\#\# \*\*背景と目的\*\*

従来の荷受け業務では、手書きの伝票を用いた計量記録が一般的でした。この運用には以下のような課題がありました。

\* 転記作業の負担: 事務員が手書き伝票の内容をシステムに再入力する必要があり、時間と手間がかかる。    
\* ヒューマンエラー: 読み間違いや入力ミスにより、不正確なデータが記録されるリスクがある。    
\* リアルタイム性の欠如: 記録がデータ化されるまでにタイムラグが発生する。

本アプリはこれらの課題を解決し、\\\*\\\*「手書き運用の撤廃による業務効率の最大化」\\\*\\\*を目的としています。ドライバー自身が記録を完結させることで、事務員の作業を大幅に削減し、データの正確性と即時性を向上させます。

\#\# \*\*主な機能\*\*

\* 多段階認証フロー:    
  \* 会社・顧客ごとの共有PINコードと、ドライバー個人のパスワードによる2段階認証を採用。    
  \* 初回ログイン時にはパスワード設定を要求し、セキュアな利用を促進します。    
\* 状況に応じた計量フロー:    
  \* 高速計量モード (Express Mode): マスターデータに登録されている回収先と品目がそれぞれ1種類のみの場合に自動で有効化されます。総重量入力後、すぐに空車計量に進める3ステップの最短フローで、特定の運用に特化した高速な記録を実現します。    
  \* 標準計量フロー:    
    1\. 記録の種類の選択: まず「自社の荷物」か「回収先の荷物」かを選択し、記録の目的を明確にします。    
    2\. 記録方法の選択: 次に「品目を個別に追加する」か「まとめて最終計量へ進む」かを選択でき、荷物の種類や量に応じた最適な方法で記録を進められます。    
    3\. 柔軟な品目記録: 「品目を個別に追加する」フローでは、複数の回収先や品目を自由に追加できます。前回使用した外部の回収先は記憶され、次回入力時に自動で選択されるため、繰り返し作業が効率化されます。    
  \* 差分計量と手入力のハイブリッド対応: 品目重量の記録は、正確な「差分計量」と迅速な「手入力」の両方に対応しています。    
\* オフライン対応:    
  \* Service Workerによるキャッシュ戦略を採用し、ネットワークが不安定な場所や圏外でもアプリの起動と記録の入力が可能です。    
  \* オフライン中に入力されたデータはIndexedDBに安全に保存され、オンライン復帰時に自動でサーバーへ同期されます。    
\* 計量履歴の閲覧・編集:    
  \* 過去の計量記録を時系列で一覧表示し、詳細を確認できます。    
  \* セキュリティとデータ整合性のため、記録後24時間以内であれば、総重量、空車重量、品目情報の追加・編集・削除が可能です。    
\* 重量の誤差検証:    
  \* 総重量 \\- 空車重量 から算出される「差引重量」と、登録された全品目の重量合計 を自動で比較します。    
  \* 誤差がある場合は送信前に警告を表示し、記録の正確性を担保します。最終確認画面で品目重量を編集・削除した場合でも、総重量が自動的に再計算されるため、スムーズに記録を完了できます。    
\* 個人設定:    
  \* ユーザーごとに設定が保存され、どのデバイスからログインしても同じUI体験が維持されます。    
  \* テーマ: ライト、ダーク、システム設定追従の3種類から選択可能。    
  \* フォントサイズ: 小、中、大の3段階で調整可能。    
  \* ナビゲーションヒント: 次に操作すべきボタンを視覚的に強調するアニメーション効果のオン/オフを切り替えられます。

\#\# \*\*技術スタックと選定理由\*\*

本アプリケーションは、モダンなWeb技術を基盤としつつ、コスト効率とメンテナンス性、そして迅速な開発を重視して技術選定を行いました。

\* フロントエンド:    
  \* フレームワーク: \[React\](https://react.dev/) (v19) \\- コンポーネントベースのUI構築における業界標準であり、豊富なエコシステムを持つため採用。    
  \* 言語: \[TypeScript\](https://www.typescriptlang.org/) \\- 静的型付けにより、コードの堅牢性を高め、大規模な開発でも品質を維持しやすくします。    
  \* UI: \[Tailwind CSS\](https://tailwindcss.com/) \\- ユーティリティファーストのアプローチにより、CSSを直接書くことなく迅速かつ一貫性のあるUIデザインが可能です。    
  \* 状態管理: React Context API \\- 責務ごとにContextを分割し、小〜中規模のアプリケーションにおいて外部ライブラリを追加することなく状態を管理できるため、シンプルさを維持できます。    
  \* アイコン: \[Lucide React\](https://lucide.dev/) \\- 軽量でツリーシェイキングに対応しており、アプリケーションのバンドルサイズを小さく保ちます。    
\* オフラインストレージ:    
  \* \[IndexedDB\](https://developer.mozilla.org/ja/docs/Web/API/IndexedDB\_API) (via idb library) \\- 大量の構造化データをクライアントサイドで永続化させるための標準的な技術です。マスターデータ、計量履歴、オフライン送信キューの3つのストアを管理します。    
\* バックエンド & データベース:    
  \* API: \[Google Apps Script (GAS)\](https://developers.google.com/apps-script) \\- Google Workspace上で動作するサーバーレス環境。追加のサーバーコストなしでAPIを構築できます。    
  \* データベース: \[Google Sheets\](https://www.google.com/intl/ja\_jp/sheets/about/) \\- 専門的なデータベース管理者を必要とせず、事務員でも直接データを確認・編集できるため、運用負荷が低いと判断しました。    
\* ホスティング:    
  \* AI Studioが提供するPWA開発・ホスティング環境を利用。

\#\# \*\*プロジェクト構成\*\*

.    
├── components/    
│   ├── auth/    
│   │   └── LoginScreen.tsx    
│   ├── common/    
│   │   ├── AppInitializer.tsx, Footer.tsx, Header.tsx ...    
│   ├── history/    
│   │   └── HistoryScreen.tsx    
│   ├── settings/    
│   │   └── SettingsScreen.tsx    
│   ├── weighing/    
│   │   ├── ConfirmStep.tsx, ItemsStep.tsx, WeighingFlow.tsx ...    
│   └── ui/    
│       ├── Button.tsx, Card.tsx, Modal.tsx ...    
├── contexts/    
│   ├── AuthContext.tsx, HistoryContext.tsx, MasterDataContext.tsx ...    
├── hooks/    
│   └── useOnlineStatus.ts    
├── services/    
│   ├── db.ts              \\\# IndexedDB interaction logic    
│   └── gasApi.ts          \\\# API communication layer    
├── App.tsx    
├── constants.ts    
├── index.html    
├── index.tsx    
├── metadata.json    
├── README.md    
└── types.ts               \\\# All type definitions

\#\# \*\*開発環境のセットアップ\*\*

本プロジェクトは、Node.jsやnpmなどの環境構築を必要とせず、ブラウザとエディタのみで開発を開始できるシンプルな構成です。

\#\#\#\# \*\*1\\. 前提条件\*\*

\* \[Visual Studio Code\](https://code.visualstudio.com/) (推奨)    
\* VS Codeの拡張機能: \[Live Server\](https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer)

\#\#\#\# \*\*2\\. 起動手順\*\*

1\. このリポジトリの全ファイルをローカルマシン上の一つのフォルダに配置します。    
2\. VS Codeでそのフォルダを開きます。    
3\. VS Codeの拡張機能マーケットプレイスで「Live Server」を検索し、インストールします。    
4\. VS Codeのエクスプローラーで index.html ファイルを右クリックし、「Open with Live Server」を選択します。    
5\. ブラウザが自動的に起動し、アプリケーションが表示されます。ファイルの変更は保存時に自動的にブラウザへ反映されます。

\#\# \*\*バックエンド設定 (Google Sheets & Apps Script)\*\*

本アプリケーションは、バックエンドとしてGoogle Apps Script（GAS）を利用します。

\#\#\# \*\*1\\. Google Sheetsのスキーマ定義\*\*

新しいGoogleスプレッドシートを作成し、以下の7つのシートを定義してください。

| シート名 | カラム (例) | 説明 |  
| \----- | \----- | \----- |  
| Auth | pin, password, userType, companyName, driverName | 認証情報を格納。pinは共有、passwordは個人用。userTypeは 'company'/'customer'。 |  
| Locations | id, name | 回収先マスタデータ。 |  
| Items | id, name | 品目マスタデータ。 |  
| WeighingRecords | recordId, driverName, companyName, grossWeight, tareWeight, netWeight, weighedAt | 計量記録のヘッダー情報。recordIdが主キー。 |  
| RecordItems | recordItemId, recordId, locationId, itemId, weight | 計量記録の明細情報。recordIdはWeighingRecordsへの外部キー。 |  
| UserSettings | driverName, fontSize, theme, isPulseEffectEnabled | ユーザーごとの個人設定を格納。 |  
| Config | key, value | アプリ全体の設定を格納（例：contactPerson, contactNumber）。 |

\#\#\# \*\*2\\. Google Apps Scriptのデプロイ\*\*

1\. 作成したスプレッドシートから、「拡張機能」 \\\> 「Apps Script」を選択してスクリプトエディタを開きます。    
2\. doPost(e) 関数を実装し、リクエストボディの action パラメータに応じて処理を分岐させるルーティングロジックを記述します。（詳細は後述のAPI仕様を参照）    
3\. 「デプロイ」 \\\> 「新しいデプロイ」を選択し、種類を「ウェブアプリ」に設定します。    
4\. 「アクセスできるユーザー」を\\\*\\\*「全員」\\\*\\\*に設定します。    
5\. デプロイ後、表示されたウェブアプリURLをコピーします。    
6\. constants.ts ファイルの GAS\\\_API\\\_URL をコピーしたURLに書き換えます。    
7\. services/gasApi.ts ファイル内の MOCK\\\_API フラグを false に変更すると、実際のGAS APIにリクエストが送信されるようになります。

\#\# \*\*API仕様とデータモデル\*\*

本アプリは、単一のGASウェブアプリURLをエンドポイントとし、リクエストボディに含まれるactionプロパティによって処理を振り分けるアーキテクチャを採用しています。すべてのリクエストはPOSTメソッドを使用します。

\#\#\# \*\*データモデル\*\*

主要なデータ構造は types.ts で定義されています。

主要なデータモデル（クリックで展開）

計量記録 (WeighingRecordPayload)

interface WeighingRecordPayload {    
  recordId: string;      // UUID    
  driverName: string;    
  companyName: string | null;    
  grossWeight: number;   // 総重量    
  tareWeight: number;    // 空車重量    
  netWeight: number;     // 差引重量    
  items: WeighingItem\\\[\\\]; // 品目明細    
  weighedAt: string;     // ISO 8601 形式の日時    
}

interface WeighingItem {    
  locationId: string;    
  itemId: string;    
  weight: number;    
}

マスターデータ (MasterData)

interface MasterData {    
  locations: Location\\\[\\\];    
  items: Item\\\[\\\];    
}    
interface Location { id: string; name: string; }    
interface Item { id: string; name: string; }

個人設定 (UserSettings)

interface UserSettings {    
  fontSize: 'sm' | 'md' | 'lg';    
  theme: 'light' | 'dark' | 'system';    
  isPulseEffectEnabled: boolean;    
}

\#\#\# \*\*APIエンドポイント詳細\*\*

\#\#\#\# \*\*verifyPin\*\*

会社または顧客の共有PINコードを検証し、関連するドライバー情報を返します。

\* Request Body: { action: 'verifyPin', pin: string }    
\* Response Body: VerificationResult

interface VerificationResult {    
  success: boolean;    
  message?: string;    
  userType?: 'company' | 'customer';    
  company?: { id: string; name: string };    
  customerName?: string;    
  drivers?: { id: string; name: string; hasSetPassword?: boolean }\\\[\\\];

\* }

\#\#\#\# \*\*authenticate\*\*

ドライバー名と個人パスワードで認証を行います。成功すると個人設定も返します。

\* Request Body: { action: 'authenticate', name: string, personalPassword: string }    
\* Response Body: AuthResponse

type AuthResponse \\=     
  | { success: true; driverName: string; companyName: string | null; userType: 'company' | 'customer', settings: UserSettings }

\*   | { success: false; message: string };

\#\#\#\# \*\*setInitialPassword\*\*

初回ログイン時にユーザーのパスワードを設定します。

\* Request Body: { action: 'setInitialPassword', driverName: string, newPassword: string }    
\* Response Body: AuthResponse

\#\#\#\# \*\*changePassword\*\*

既存のパスワードを変更します。

\* Request Body: { action: 'changePassword', driverName: string, oldPassword: string, newPassword: string }    
\* Response Body: AuthResponse

\#\#\#\# \*\*saveUserSettings\*\*

ユーザーの個人設定（テーマ、フォントサイズ等）を保存します。

\* Request Body: { action: 'saveUserSettings', driverName: string, settings: UserSettings }    
\* Response Body: { success: boolean }

\#\#\#\# \*\*getMasterData\*\*

回収先と品目のマスターデータを取得します。

\* Request Body: { action: 'getMasterData' }    
\* Response Body: MasterData

\#\#\#\# \*\*submitWeighingRecord\*\*

新しい計量記録をサーバーに送信します。

\* Request Body: { action: 'submitRecord', record: WeighingRecordPayload }    
\* Response Body: { success: boolean }

\#\#\#\# \*\*getHistory\*\*

指定されたドライバーの過去の計量記録を取得します。

\* Request Body: { action: 'getHistory', driverName: string }    
\* Response Body: WeighingRecordPayload\\\[\\\]

\#\#\#\# \*\*updateWeighingRecord\*\*

既存の計量記録を更新します。

\* Request Body: { action: 'updateRecord', record: WeighingRecordPayload }    
\* Response Body: { success: boolean }

\#\#\# \*\*重要なビジネスロジック\*\*

\* アプリケーション設定の外部化: ヘルプモーダルに表示されるお問い合わせ情報（担当者名、連絡先）は、管理側アプリケーションから動的に設定できるようにすることが理想です。これを実現するため、Google SheetsにConfigシートを新設し、contactPersonやcontactNumberといったキーで情報を管理することを推奨します。フロントエンドは、起動時にこれらの設定をAPI経由で取得し、表示に反映させます。    
\* 記録の編集期間: フロントエンドでは、記録後24時間を経過したデータは編集不可になります。管理側アプリケーションでは、この制約を緩和することも可能ですが、ドライバー側の仕様として認識しておく必要があります。    
\* 重量の整合性検証: netWeight は grossWeight \\- tareWeight で計算されます。この値と items の合計重量 totalItemsWeight が一致することが、記録の正確性の基準となります。管理側アプリでもこの検証ロジックを実装することが推奨されます。    
\* 特殊なLocation ID:    
  \* own-company: 協力会社ドライバーが自社荷物として記録した場合に使用されます。companyNameで会社名を特定します。    
  \* customer-self: 顧客が自身の荷物として記録した場合に使用されます。driverNameで顧客名を特定します。 管理側アプリでは、これらのIDを動的に名前に解決する処理が必要です。

\#\# \*\*アプリケーションの現状と今後の展望\*\*

\#\#\# \*\*アプリケーションの現状: Post-MVP\*\*

本アプリケーションは、当初のMVP（Minimum Viable Product）要件をすべて満たし、安定して稼働する完成版の製品です。現場での運用に必要なコア機能はすべて実装されており、手書き運用の撤廃という当初の目的を達成可能な状態にあります。

services/gasApi.ts内のMOCK\\\_APIフラグを切り替えることで、モック環境と実際のGASバックエンドとの連携をシームレスにテストできます。

\#\#\# \*\*今後の展望: Phase 2\*\*

現在の安定した基盤の上に、さらなる業務効率化を目指すための機能拡張を検討しています。

\* カメラによる証拠写真の撮影: 総重量および空車重量計量時に、証拠として計量器の写真を撮影・保存する機能。    
\* Google Drive連携: 撮影した写真を記録IDと紐付けてGoogle Driveに自動でアップロードする。    
\* OCRによる重量自動読み取り: 写真から数値を自動で読み取り、入力の手間を完全に排除する機能。    
\* 管理者向けダッシュボードの強化: より高度なデータ分析やレポート機能を管理者向けに提供する。

これらの機能拡張は、現在のバージョンの運用を通じて収集されるユーザーフィードバックを基に、次の開発フェーズで進められる予定です。 

   
\#  2\*\*セルフ計量記録アプリ 管理画面\*\*

\#\# \*\*1\\. プロジェクトビジョン\*\*

本プロジェクトは、\\\*\\\*「計量業務のDX（デジタルトランスフォーメーション）を加速させる」\\\*\\\*ことを目的とした、管理者向けの業務用Webアプリケーションです。

ドライバーが現場で入力した計量データを、管理者がオフィスでリアルタイムに把握し、検証・分析・活用できる環境を構築します。従来のアナログな管理手法から脱却し、データの正確性向上、業務効率化、そしてデータに基づいた意思決定を支援することを目指します。

\---

\#\# \*\*2\\. 現在の実装状況 (MVP v1完了)\*\*

設計書の「MVPリリース（最優先）」フェーズが完了しています。これはアプリケーションの核となる「データの可視化」と「ドリルダウンによる深掘り分析」のサイクルを実証するバージョンです。

\#\#\# \*\*2.1. 主要機能\*\*

ダッシュボード機能 \\- 全体像の即時把握

\* 動的サマリーカード: システムの状態を要約する4つの主要指標（本日の記録数、今月の記録数、未確認の記録、エラー件数）をAPI（モック）から動的に取得し、一目でわかるように表示します。    
\* グラフによるデータ可視化: 過去30日間の日別計量件数をインタラクティブな棒グラフで表示します。Rechartsライブラリを利用し、リッチなツールチップやアニメーションを提供します。    
\* ドリルダウン機能: このバージョンの最重要機能です。グラフの特定の棒や「最近の記録」テーブルの行をクリックすることで、その日付でフィルタリングされた状態で「計量記録一覧」画面へシームレスに遷移します。これにより、ユーザーは「全体像の把握」から「個別の問題の発見」へと直感的に分析を進めることができます。

計量記録管理機能 \\- データへの詳細アクセス

\* 一覧表示とページネーション: 全ての計量記録をページネーション付きのテーブルで効率的に閲覧できます。    
\* 動的フィルタリング: ダッシュボードからのドリルダウン時に渡されたパラメータ（例：特定の日付）を解釈し、該当する記録のみを自動でフィルタリングします。適用中のフィルタはUI上に明示され、ワンクリックで解除できます。    
\* インライン詳細展開: テーブルの各行をクリックすると、その場で詳細情報（重量検証、品目内訳、修正履歴など）がアコーディオン形式で展開されます。    
\* データ整合性検証: 詳細表示内では、総重量 \\- 空車重量で算出される差引重量と、品目ごとの重量の合計を比較検証するUIを搭載。不一致がある場合は警告を表示し、管理者がデータの不整合を迅速に発見できるよう支援します。    
\* CSVエクスポート: 現在フィルタリングされているデータをCSVファイルとしてダウンロードできます。

マスタ管理機能 \\- データ基盤の整備

\* 統合管理UI: 協力会社、ドライバー、顧客、回収先、品目の5つのマスターデータを、統一されたタブ形式のUIで一元管理できます。    
\* 標準CRUD操作: 各マスターデータに対して、検索、新規追加、編集、削除の基本的な操作を、直感的なモーダルウィンドウと確認ダイアログを通じて実行できます。    
\* スケーラブルな品目設定UI: 回収先ごとに取り扱う品目を設定する機能が強化されました。    
  \* タグベースの表示: 設定済みの品目はタグとして表示され、一目で確認・削除が可能です。    
  \* モーダルによる追加: 「品目を追加」ボタンから専用モーダルを開き、多数の品目の中から検索して効率的に追加できます。これにより、品目数が将来的に増加しても快適な操作性を維持します。    
\* 設定状況の可視化: 回収先の一覧画面では、各回収先が取り扱う品目数が表示され、一つも設定されていない場合は警告アイコンと共に「未設定」と表示されるため、設定漏れを容易に発見できます。

共通機能

\* テーマ切り替え: ユーザーの好みに合わせてライトモード、ダークモード、システム設定追従の3つのテーマを切り替え可能です。localStorageに設定が保存されます。    
\* Toast通知: データの保存成功や削除失敗といった操作結果を、画面右下に表示されるToast（トースト）通知でユーザーにフィードバックします。    
\* レスポンシブデザイン: Tailwind CSSのブレークポイントを活用し、PCやタブレットでの閲覧に最適化されています。

\---

\#\# \*\*3\\. 技術スタックとアーキテクチャ\*\*

本プロジェクトは、迅速なプロトタイピングと開発効率を最優先に考えた、軽量かつモダンな技術スタックを採用しています。

\* フロントエンド: \[React\](https://react.dev/) 19.2.0 \\+ \[TypeScript\](https://www.typescriptlang.org/)    
\* スタイリング: \[Tailwind CSS\](https://tailwindcss.com/)    
\* 主要ライブラリ:    
  \* グラフ: \[Recharts\](https://recharts.org/)    
  \* アイコン: \[Lucide React\](https://lucide.dev/)    
\* バックエンド: Google Apps Script (GAS) \\+ Google Sheets を想定していますが、現在はモックAPI (services/mockApi.ts) を使用して開発を進めています。

\#\#\# \*\*3.1. アーキテクチャの思想: "No Build Tool"\*\*

本プロジェクトは、npmやVite, Webpackといったビルドツールを意図的に使用していません。

\* 理由: MVP開発フェーズにおいて、環境構築の複雑さを排除し、誰でもすぐにコードを触れる状態を作ることを最優先しました。    
\* 実現方法: index.htmlに記述されたimportmap機能を利用しています。これにより、ES Modulesのimport構文を使いながら、ライブラリをCDNから直接、動的に読み込んでいます。node\\\_modulesは存在しません。

\#\#\# \*\*3.2. 状態管理\*\*

\* 現状: App.tsxに状態を集約し、各画面コンポーネントにPropsとして受け渡す「リフトアップ」パターンを採用しています。    
\* 画面遷移: Viewオブジェクト（{ name: ViewName; params?: Record\\\<string, string\\\> }）で現在の画面とそのパラメータを管理しています。setCurrentViewを呼び出すことで、画面遷移とデータ（フィルタ条件など）の受け渡しを同時に行います。

\#\#\# \*\*3.3. API連携\*\*

本アプリケーションは、開発効率と将来の拡張性を両立させるため、切り替え可能なAPIアーキテクチャを採用しています。

\* services/api.ts (API Switcher): アプリケーション内のすべてのデータアクセスは、このファイルを経由します。ファイル内の USE\\\_MOCK\\\_API というフラグを true にするとモックAPI、false にすると本番APIに接続先が切り替わります。    
\* services/mockApi.ts (Mock Backend): 開発用のモックデータを提供します。setTimeoutによる意図的な遅延が加えられており、実際のネットワークレイテンシをシミュレートしています。    
\* services/apiClient.ts (Production Client Stub): Google Apps Scriptで構築された本番バックエンドと通信するためのクライアントの雛形です。google.script.run を使用してサーバーサイド関数を呼び出すための準備が整っています。

この構造により、開発者はバックエンドの準備ができていなくてもフロントエンドの開発を安全に進めることができ、本番への移行もスムーズに行えます。

\---

\#\# \*\*4\\. 開発の始め方\*\*

\#\#\# \*\*4.1. 前提条件\*\*

\* 最新のWebブラウザ (Chrome, Firefox, Edgeなど)    
\* コードエディタ (VSCodeを推奨)    
\* ローカルWebサーバーを起動する手段

\#\#\# \*\*4.2. セットアップ手順\*\*

1\. 本プロジェクトのファイルをローカルマシンにダウンロードまたはクローンします。    
2\. プロジェクトのルートディレクトリで、ローカルWebサーバーを起動します。    
   \* 推奨 (VSCode): \[Live Server\](https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer) 拡張機能をインストールし、index.htmlを右クリックして Open with Live Server を選択します。    
   \* Python 3: ターミナルで python \\-m http.server を実行します。    
   \* Node.js: npm install \\-g serve を実行後、serve . を実行します。    
3\. ブラウザで指定されたアドレス（例: http://127.0.0.1:5500）にアクセスします。これだけでアプリケーションが動作します。

\---

\#\# \*\*5\\. ディレクトリ構成と主要ファイルガイド\*\*

.    
├── components/         \\\# Reactコンポーネント    
│   ├── dashboard/      \\\# ダッシュボード画面関連    
│   ├── layout/         \\\# 全体レイアウト (ヘッダー, サイドバー)    
│   ├── masters/        \\\# マスタ管理画面関連    
│   ├── records/        \\\# 計量記録画面関連    
│   └── ui/             \\\# 再利用可能な汎用UI (Button, Card, Skeletonなど)    
├── constants.ts        \\\# 定数 (ナビゲーション項目など)    
├── contexts/           \\\# Reactコンテキスト (テーマ管理, Toast通知)    
├── hooks/              \\\# カスタムフック (useTheme, useToast)    
├── services/           \\\# 外部サービス連携    
│   ├── api.ts          \\\# ★API切り替えスイッチ    
│   ├── apiClient.ts    \\\# ★本番APIクライアント (雛形)    
│   └── mockApi.ts      \\\# ★モックAPI    
├── types.ts            \\\# ★最重要: プロジェクト全体のTypeScript型定義    
├── App.tsx             \\\# アプリケーションのメインコンポーネント (画面ルーティング)    
├── index.html          \\\# HTMLエントリーポイント (importmap, Tailwind CSS設定)    
├── index.tsx           \\\# Reactアプリケーションのマウントポイント    
└── README.md           \\\# このファイル

\* 新規開発者の方へ: まずは types.ts でデータ構造を把握し、次に App.tsx で画面全体の構成を理解することをお勧めします。

\---

\#\# \*\*6\\. 今後の開発ロードマップ\*\*

\#\#\# \*\*Phase C: 計量記録管理の高度化\*\*

\* \\\[x\\\] 多角的フィルタUIの実装    
\* \\\[x\\\] キーワード検索機能    
\* \\\[x\\\] インライン展開機能    
\* \\\[x\\\] CSVエクスポート機能

\#\#\# \*\*Phase D: マスターデータ管理\*\*

\* \\\[x\\\] 各マスター管理画面の作成    
\* \\\[x\\\] データ連携

\#\#\# \*\*Phase E: バックエンド統合\*\*

\* \\\[\\\~\\\] APIクライアントの実装 (雛形完了):    
  \* Google Apps Script (GAS) バックエンドと通信するためのアーキテクチャを導入しました。    
  \* services/api.ts: アプリケーション全体が参照する統一APIエンドポイント。このファイル内のフラグを切り替えるだけで、データの取得先をモックと本番APIで瞬時に切り替え可能です。    
  \* services/apiClient.ts: GASの本番APIを呼び出すためのクライアントの雛形です。実際のGAS関数名に合わせてこのファイルを編集することで、本番環境へ接続できます。    
  \* services/mockApi.ts: 従来通り、オフライン開発やテストに使用するモックデータを提供します。    
\* \\\[\\\~\\\] モックからの切り替え (コンポーネント参照先更新完了):    
  \* すべてのコンポーネントが mockApi.ts の代わりに新しい api.ts を参照するように修正済みです。これにより、コンポーネント側はAPIの接続先を意識する必要がなくなりました。    
\* \\\[ \\\] 本番API関数の実装とエラーハンドリング:    
  \* apiClient.ts に実際のAPI呼び出し処理を実装し、認証や詳細なエラーハンドリングを追加する。

\#\#\# \*\*その他\*\*

\* \\\[ \\\] テスト:    
  \* 主要なビジネスロジック（重量検証など）に対する単体テストを導入する。

\---

\#\# \*\*7\\. コーディング規約・用語統一\*\*

プロジェクトの品質と一貫性を保つため、以下の規約を遵守してください。

\#\#\# \*\*7.1. 用語統一の基本方針\*\*

\* 顧客の呼称: アプリケーション内のUIテキスト、コメント、ドキュメントにおいて、「一般顧客」という表現は使用せず、\\\*\\\*「顧客」\\\*\\\*に統一してください。

\#\#\# \*\*7.2. 主要な用語の定義\*\*

| 用語 | 定義 | 役割・具体例 |  
| \----- | \----- | \----- |  
| 協力会社 (Company) | 荷物の回収・運搬業務を委託されている会社。 | アプリを利用する「ドライバー」が所属する組織。例: ログイン時に「A商事」のPINコードを入力すると、その会社のドライバーとして認識される。 |  
| 顧客 (Customer) | ご自身で荷物を直接持ち込む個人または法人のお客様。 | 協力会社に所属せず、独立してアプリを利用するユーザー。例: 「鈴木様」の顧客用PINコードでログインすると、顧客本人として認識される。 |  
| ドライバー (Driver) | スマートフォンでこのアプリを操作する担当者本人。 | 「協力会社」の従業員である場合と、「顧客」本人である場合がある。システム上はdriverNameで一意に識別される。 |  
| 回収先 (Location) | 「協力会社」のドライバーが荷物を回収してきた場所（取引先など）。 | 品目ごとに「どこから来た荷物か」を記録するためのマスターデータ。例: 「A商事」「B新聞社」など。 |

\#\#\# \*\*7.3. 認証と計量フローにおける主要ルール\*\*

これらの用語は、特にクライアントアプリ（ドライバー向け）のログイン時と計量フローで重要な役割を果たします。

\* ログイン時:    
  \* 最初に「会社PINコード」を入力することで、ユーザーが「協力会社」なのか「顧客」なのかをシステムが判断します。    
  \* その後、ドライバーリストから個人を選択し、個人パスワードで認証します。    
\* 計量フロー (CustomerSelectionStep.tsx):    
  \* 「自社の荷物として記録」: このボタンの挙動はログインユーザーの属性(userType)によって変わります。    
    \* 協力会社ドライバーの場合: 所属する会社（例: A商事）自身の荷物として記録されます。内部的には own-company という特別なIDで処理されます。    
    \* 顧客の場合: 顧客自身（例: 鈴木様）の荷物として記録されます。内部的には customer-self というIDで処理されます。    
  \* 「回収先を選んで記録する」:    
    \* この選択肢は主に「協力会社」のドライバーが、マスターデータに登録されている複数の「回収先」から集荷した荷物を記録するために使用します。

このように、ログインしたユーザーの属性に応じて、UIの表示やデータの記録方法が動的に最適化される設計になっています。これにより、多様な運用形態に柔軟に対応することが可能です。

\#\#\# \*\*7.4. 主要な業務ロジックと制約\*\*

\* 計量単位の制約: 台貫（grossWeight, tareWeight）による計量、および品目入力時に計量方法が「台貫」に指定された重量は、全て10kg単位で行われます。したがって、これらの値の1の位は常に0でなければなりません。システムは、このルールに違反するデータの入力を防ぎ、既存の違反データを視覚的に警告する必要があります。    
\*  
